#!/usr/bin/env groovy

pipeline {
    agent any
    stages {
        when {
            branch 'master'
            beforeOptions true
            beforeAgent true
        }
        stage('hub.docker.com'){
            steps {
                script {
                    def master = docker.image("registry.mahillmann.de/mailassistant:master")
                        master.tag("margebouvier/mailassistant:master")
                    docker.withRegistry(credentialsId: 'docker-hub-credentials'){
                        docker.image("margebouvier/mailassistant:master").push()
                    }
                } // script
            } // steps
        } // stage - hub.docker.com
        stage('github.com'){
            when {
                branch 'master'
                beforeOptions true
                beforeAgent true
            }
            steps {
                script {
                    withCredentials([usernamePassword(credentialsId: 'gitea-jenkins', passwordVariable: 'giteaPass', usernameVariable: 'giteaUser')
                                   , usernamePassword(credentialsId: 'github-com', passwordVariable: 'githubPass', usernameVariable: 'githubUser')]) {
                        sh "git clone --mirror https://${giteaUser}:${giteaPass}@gitea.mahillmann.de/Marcel/mailAssistant"
                        sh "git push --mirror https://${githubUser}:${githubPass}@github.com/MarcelHillmann/mailAssistant"
                    } // withCredentials
                } // script
            } // steps
        } // stage - github.com
    } // stages
} // pipeline